"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[354],{354:(j,u,i)=>{i.r(u),i.d(u,{AccessPageModule:()=>E});var r=i(9808),h=i(4182),n=i(3996),l=i(1264),c=i(655),m=i(8180),p=i(8411),t=i(9863),f=i(2468),A=i(1086),C=i(7221),Z=i(2340),P=i(520);const y=Z.N.url;let M=(()=>{class e{constructor(o){this.http=o}findByBandCode(o,s,d=""){return console.log(Object.assign({code_request:o},s)),this.http.get(`${y}api/auth/bandreq`,{params:Object.assign(Object.assign({code_request:o},s),{objeto:d})}).pipe((0,C.K)(this.handleError))}handleError(o){return(0,A.of)(o.error)}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(P.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var T=i(6281),b=i(3003),x=i(8507),S=i(9645);const F=function(e){return{"pick-avatar-seleccionado":e}};function Y(e,a){if(1&e){const o=t.EpF();t.TgZ(0,"ion-col"),t.TgZ(1,"ion-img",6),t.NdJ("click",function(){const g=t.CHM(o).$implicit;return t.oxw(2).seleccionarAvatar(g)}),t.qZA(),t.TgZ(2,"p"),t._uU(3),t.qZA(),t.qZA()}if(2&e){const o=a.$implicit;t.xp6(1),t.MGl("src","/assets/avatars/",o.img,""),t.Q6J("ngClass",t.VKq(3,F,o.seleccionado)),t.xp6(2),t.Oqu(o.label)}}function O(e,a){if(1&e&&(t.TgZ(0,"div"),t.TgZ(1,"h3"),t._uU(2,"\xbfQui\xe9n me encontr\xf3? "),t.qZA(),t.TgZ(3,"ion-grid"),t.TgZ(4,"ion-row"),t.YNc(5,Y,4,5,"ion-col",5),t.qZA(),t.qZA(),t.qZA()),2&e){const o=t.oxw();t.xp6(5),t.Q6J("ngForOf",o.avatars)}}function q(e,a){1&e&&(t.TgZ(0,"div"),t.TgZ(1,"h3"),t._uU(2,"No se han econtrado un resultado asociado al codigo le\xeddo "),t.qZA(),t.qZA())}const B=[{path:"",component:(()=>{class e{constructor(o,s,d,g,v,I,Q,R,G){this.navCtrl=o,this.dataService=s,this.route=d,this.qrCode=g,this.geolocation=v,this.toastMessage=I,this.waitMessage=Q,this.barcodeScanner=R,this.modalCtrl=G,this.ubicacion={},this.notFound=!1,this.avatars=[{img:"persona.png",label:"Ciudadano",seleccionado:!0},{img:"policia.png",label:"Policia",seleccionado:!1},{img:"paramedico.png",label:"Personal m\xe9dico",seleccionado:!1},{img:"bombero.png",label:"Bombero",seleccionado:!1},{img:"militar.png",label:"Defensa civ\xedl",seleccionado:!1}],this.avatarSlide={slidesPerView:1.6}}ngOnInit(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.getPosition(),yield this.openVerificationModal()})}seleccionarAvatar(o){this.avatars.forEach(s=>s.seleccionado=!1),o.seleccionado=!0,this.dataService.setAvatar(o),"Ciudadano"===this.dataService.getAvatar().label?(this.dataService.isCivilAccesing=!0,this.navCtrl.navigateForward("/tab1")):"Policia"===this.dataService.getAvatar().label?this.openQRScannerModal():(this.navCtrl.navigateForward("/authentication"),this.dataService.isCivilAccesing=!1)}openQRScannerModal(){return(0,c.mG)(this,void 0,void 0,function*(){yield(yield this.modalCtrl.create({component:m.a})).present()})}openVerificationModal(){return(0,c.mG)(this,void 0,void 0,function*(){const o=yield this.modalCtrl.create({component:p.q,backdropDismiss:!1});yield o.present(),yield o.onDidDismiss(),this.enviarNotificacion()})}enviarNotificacion(){return(0,c.mG)(this,void 0,void 0,function*(){this.bandCodeRequest=this.route.snapshot.paramMap.get("bandCodeRequest"),this.dataService.setBandCodeRequest(this.bandCodeRequest);const o=yield this.qrCode.findByBandCode(this.bandCodeRequest,this.ubicacion,this.dataService.verifObjeto).toPromise();console.log("codrequest",o),o.success||(this.notFound=!0),this.toastMessage.presentToast(o.message)})}getPosition(){return(0,c.mG)(this,void 0,void 0,function*(){this.waitMessage.present();try{const o=yield this.geolocation.getCurrentPosition();o&&(this.ubicacion={latitude:o.coords.latitude,longitude:o.coords.longitude},console.log("objeto ubicacion",this.ubicacion))}catch(o){console.log("Error getting location",o)}this.waitMessage.dismiss()})}scan(){this.barcodeScanner.scan().then(o=>{console.log("EL barcode es el siguiente"),console.log("Barcode data",o.text)}).catch(o=>{console.log("Error",o)})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(n.SH),t.Y36(f.D),t.Y36(l.gz),t.Y36(M),t.Y36(T.b),t.Y36(b.K),t.Y36(x.w),t.Y36(S.m),t.Y36(n.IN))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-access"]],decls:13,vars:2,consts:[[1,"ion-no-border"],["color","primary"],[1,"ion-margin"],[4,"ngIf"],["routerLink","/initial","size","small","fill","outline","color","primary"],[4,"ngFor","ngForOf"],[1,"avatar",3,"src","ngClass","click"]],template:function(o,s){1&o&&(t.TgZ(0,"ion-header",0),t.TgZ(1,"ion-toolbar"),t.TgZ(2,"ion-title",1),t._uU(3,"Identificate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(4,"ion-content",2),t.YNc(5,O,6,1,"div",3),t.YNc(6,q,3,0,"div",3),t.qZA(),t.TgZ(7,"ion-footer"),t.TgZ(8,"ion-toolbar"),t.TgZ(9,"ion-row"),t.TgZ(10,"ion-col"),t.TgZ(11,"ion-button",4),t._uU(12," Iniciar sesi\xf3n "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.xp6(5),t.Q6J("ngIf",!s.notFound),t.xp6(1),t.Q6J("ngIf",s.notFound))},directives:[n.Gu,n.sr,n.wd,n.W2,r.O5,n.fr,n.Nd,n.wI,n.YG,n.YI,l.rH,n.jY,r.sg,n.Xz,r.mk],styles:["img[_ngcontent-%COMP%]{width:120px}.avatar[_ngcontent-%COMP%]{width:150px;opacity:.3;margin:40px auto 10px}p[_ngcontent-%COMP%]{text-align:center;font-weight:700}.pick-avatar-seleccionado[_ngcontent-%COMP%]{transition:opacity .5s linear;opacity:1!important}h3[_ngcontent-%COMP%]{text-align:center;margin-top:2rem;margin-bottom:2rem}.btn-wrapper[_ngcontent-%COMP%]{text-align:end}"]}),e})()}];let N=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[l.Bz.forChild(B)],l.Bz]}),e})(),E=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,h.u5,n.Pc,N]]}),e})()}}]);